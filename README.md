# Are Watermarked Images Editable? A Model-Agnostic Framework for Watermark-Preserving Text-Guided Image Manipulation

Official implementation of SafeMark, a framework for watermark-preserving text-guided image manipulation across diverse diffusion-based editing pipelines.

## Overview

Diffusion-based image editing enables flexible semantic manipulation but often destroys embedded watermarks, undermining image provenance and attribution.  
SafeMark integrates watermark preservation directly into the editing process, enabling semantic image manipulation while maintaining watermark integrity across heterogeneous editors.

SafeMark is editing-agnostic and can be integrated into multiple diffusion-based editing frameworks.

## Key Features

- Editing-agnostic watermark preservation  
- Plug-and-play with diffusion-based editors  
- No watermark fabrication or transfer  
- Supports multiple datasets and editing pipelines  

## Repository Structure

```text
xvzbdfgs/
├── Asyrp/
├── DiffusionCLIP/
├── eff-diff-edit/
├── data/
├── requirements.txt
└── README.md
```

## Environment Setup

```bash
conda create -n safemark python=3.8
conda activate safemark
pip install -r requirements.txt
```

Install PyTorch according to your CUDA version:

```bash
pip install torch torchvision torchaudio
```

## Datasets

Supported datasets include:

- CelebA-HQ  
- AFHQ-Dog  
- LSUN-Church  
- LSUN-Bedroom
- Human
- Dog
- Church
- Bedroom

Datasets are provided under the data directory. Images generated by Stable Signature, SleeperMark, and VINE are stored in method-specific subdirectories. Subdirectories suffixed with orig contain unwatermarked images, whereas those suffixed with hid contain images watermarked using HiDDeN.

## Pretrained Watermark Encoder/Decoder

Pretrained watermark models are provided via Google Drive:

DiffusionCLIP: https://drive.google.com/drive/folders/1juWEkCd_RhgUMiewkeqVXlMsazwZ1mbp?usp=sharing

Asyrp: https://drive.google.com/drive/folders/19NNfVvlNCaI5b-xdPh7L816BmSbTxW-P?usp=sharing

Eff-Diff: https://drive.google.com/drive/folders/1M7ZSlw-OWuHSMRGxUCYRiO3hK4brdWML?usp=sharing

After downloading, place files under each edit method folder. For example,

```text
DiffusionCLIP/
├── checkpoint/
├── precomputed/
├── pretrained/
├── out/
├── main.py
├── ...
```

## Running SafeMark

### DiffusionCLIP Backend

```bash
cd DiffusionCLIP
python main.py
```

### Asyrp Backend

```bash
cd Asyrp
python main.py
```

### Efficient Diffusion Editing Backend

```bash
cd eff-diff-edit
python main.py
```

## Evaluation

```bash
python eval365.py
```

Metrics include:

- Watermark bit accuracy  
- CLIP similarity  
- FID
- IS

## Reproducing Paper Results

Scripts for reproducing paper figures and tables are provided in:

```text
scripts/
```


